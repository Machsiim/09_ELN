<div class="page-container">
  <app-header />

  <main class="main-content">
    <section class="detail-card">
      <header class="detail-header">
        <button class="back-button" type="button" (click)="goBack()">
          ← Zurück
        </button>
        <div class="header-main">
          <div class="titles">
            <p class="eyebrow">Messung</p>
            <h1>#{{ measurement()?.id || '...' }}</h1>
          </div>
          @if (measurement(); as data) {
            <div class="header-meta">
              <p class="meta">
                Serie #{{ data.seriesId }} · Template: {{ data.templateName }} · Erstellt von {{ data.createdByUsername }} am
                {{ data.createdAt | date: 'dd.MM.yyyy HH:mm' }}
              </p>
              <div class="action-buttons">
                <button class="action-button">Bearbeiten</button>
                <button class="action-button danger" (click)="confirmDelete()">Löschen</button>
              </div>
            </div>
          }
        </div>
      </header>

      @if (error(); as message) {
        <div class="status error">{{ message }}</div>
      }

      @if (loading()) {
        <div class="status info">Messung wird geladen ...</div>
      }

      @if (!loading() && measurement()) {
        <div class="measurement-preview">
          <div class="preview-sections">
            @for (section of getSections(); track section.name) {
              <article class="preview-section">
                <header class="preview-section-header">
                  <h2>{{ section.name }}</h2>
                </header>
                <div class="preview-cards">
                  @for (card of section.cards; track card.name) {
                    <div class="preview-card">
                      <header class="preview-card-header">
                        <div>
                          <h3>{{ card.name }}</h3>
                          <small>{{ card.fields.length }} Feld{{ card.fields.length === 1 ? '' : 'er' }}</small>
                        </div>
                      </header>
                      <ul class="preview-fields">
                        @for (field of card.fields; track field.key) {
                          <li>
                            <div class="field-meta">
                              <span class="field-label">{{ field.key }}</span>
                              <span class="field-type">Wert</span>
                            </div>
                            <span class="field-value">{{ formatValue(field.value) }}</span>
                          </li>
                        }
                      </ul>
                    </div>
                  }
                </div>
              </article>
            }
          </div>
        </div>
      }
    </section>
  </main>

  <app-footer />
</div>

@if (deleteConfirmVisible()) {
  <div class="modal-backdrop">
    <div class="modal-dialog">
      <h2>Aktion bestätigen</h2>
      <p>Soll die Messung {{ measurement()?.id }} wirklich gelöscht werden? Diese Aktion kann nicht widerrufen werden.</p>
      <div class="modal-actions">
        <button class="modal-button" type="button" (click)="closeDeleteModal()" [disabled]="deleteInProgress()">
          Abbrechen
        </button>
        <button
          class="modal-button danger"
          type="button"
          (click)="deleteMeasurement()"
          [disabled]="deleteInProgress()"
        >
          {{ deleteInProgress() ? 'Löschen ...' : 'Löschen' }}
        </button>
      </div>
    </div>
  </div>
}
